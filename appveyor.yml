-
  version: 0.7.3.1.{build}
  branches:
    only:
    - master
  skip_tags: true

  os: Visual Studio 2015
  configuration: Release

  clone_depth: 1

  clone_folder: C:\_Repos\LunaLUA

  clone_script:
  - cmd: >-
      git clone -q --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
      && cd %APPVEYOR_BUILD_FOLDER%
      && git checkout -qf %APPVEYOR_REPO_COMMIT%
      && git submodule update --init --recursive

  build:
    project: LunaDll.sln
    verbosity: minimal

  after_build:
  - cmd: deploy-full.bat nopause

  artifacts:
  - path: LunaLUA-bin.zip
  - path: LunaLoader-bin.zip
  - path: Release\LunaDLL.dll

  deploy:
  - provider: Environment
    name: WohlnetFTP

-
  version: 0.7.3.1.{build}
  branches:
    only:
    - cleanup
  skip_tags: true

  os: Visual Studio 2017

  clone_depth: 1
  clone_folder: C:\_Repos\LunaLUA

  clone_script:
  - cmd: >-
      git clone -q --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
      && cd %APPVEYOR_BUILD_FOLDER%
      && git checkout -qf %APPVEYOR_REPO_COMMIT%
      && git submodule update --init --recursive

  build_script:
  - cmd: mkdir build-appveyor-vs2017
  - cmd: cd build-appveyor-vs2017
  - cmd: cmake ../. -G "Visual Studio 15 2017"
  - cmd: cmake --build . --config release
